<!DOCTYPE html>
<html lang="ro" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionare Servicii - Kineto Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }

        .sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }

        .sidebar .nav-link {
            color: #fff;
            padding: 15px 20px;
            border-radius: 5px;
            margin: 5px 0;
            transition: all 0.3s ease;
        }

        .sidebar .nav-link:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .sidebar .nav-link.active {
            background: rgba(255,255,255,0.2);
            font-weight: 600;
        }

        .service-card {
            transition: transform 0.2s, box-shadow 0.2s;
            border: none;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 1.5rem;
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .badge-duration {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
        }

        .badge-price {
            background: linear-gradient(135deg, var(--success-color) 0%, #20c997 100%);
            color: white;
        }

        .badge-category {
            background: var(--info-color);
            color: white;
        }

        .search-box {
            max-width: 400px;
        }

        .action-buttons .btn {
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .stat-card {
            border-radius: 10px;
            transition: transform 0.3s ease;
            border: none;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }

        .stat-card:hover {
            transform: translateY(-3px);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
        }

        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #6c757d;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .alert-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            width: 350px;
        }

        .form-label.required::after {
            content: " *";
            color: var(--danger-color);
        }
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav th:replace="~{AdminDashboard :: sidebar('services')}"></nav>

        <!-- Main content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4">
            <!-- Alert Container -->
            <div id="alertContainer" class="alert-container"></div>

            <!-- Header -->
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-4 border-bottom">
                <h1 class="h2"><i class="fas fa-spa me-2 text-primary"></i>Gestionare Servicii</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#serviceModal" onclick="openAddModal()">
                        <i class="fas fa-plus me-1"></i>Adaugă Serviciu
                    </button>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="row mb-4">
                <div class="col-md-3 mb-3">
                    <div class="card stat-card text-white bg-primary">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title mb-2">Total Servicii</h6>
                                    <h2 class="mb-0" id="totalServices">0</h2>
                                </div>
                                <div class="stat-icon bg-white bg-opacity-20">
                                    <i class="fas fa-spa"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stat-card text-white bg-success">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title mb-2">Servicii Active</h6>
                                    <h2 class="mb-0" id="activeServices">0</h2>
                                </div>
                                <div class="stat-icon bg-white bg-opacity-20">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stat-card text-white bg-info">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title mb-2">Categorii</h6>
                                    <h2 class="mb-0" id="totalCategories">0</h2>
                                </div>
                                <div class="stat-icon bg-white bg-opacity-20">
                                    <i class="fas fa-tags"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stat-card text-white bg-warning">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title mb-2">Preț Mediu</h6>
                                    <h2 class="mb-0" id="averagePrice">0</h2>
                                    <small>RON</small>
                                </div>
                                <div class="stat-icon bg-white bg-opacity-20">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search and Filter Bar -->
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0">
                                    <i class="fas fa-search text-muted"></i>
                                </span>
                                <input type="text" class="form-control border-start-0" id="searchInput" placeholder="Caută servicii...">
                                <button class="btn btn-outline-secondary" type="button" onclick="searchServices()">
                                    <i class="fas fa-filter me-1"></i>Filtrează
                                </button>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="categoryFilter" onchange="filterServices()">
                                <option value="">Toate categoriile</option>
                                <!-- Categories will be populated dynamically -->
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="sortBy" onchange="sortServices()">
                                <option value="name">Sortează după nume</option>
                                <option value="price">Sortează după preț</option>
                                <option value="duration">Sortează după durată</option>
                                <option value="category">Sortează după categorie</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Services Grid -->
            <div class="row" id="servicesContainer">
                <div class="col-12">
                    <div class="loading-spinner">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Se încarcă...</span>
                        </div>
                        <span class="ms-2">Se încarcă serviciile...</span>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Service Modal (Add/Edit) -->
<div class="modal fade" id="serviceModal" tabindex="-1" aria-labelledby="serviceModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="serviceModalTitle"><i class="fas fa-spa me-2"></i>Adaugă Serviciu Nou</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Închide"></button>
            </div>
            <div class="modal-body">
                <form id="serviceForm">
                    <input type="hidden" id="serviceId">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="numeServiciu" class="form-label required">Nume Serviciu</label>
                            <input type="text" class="form-control" id="numeServiciu" name="numeServiciu" required>
                            <div class="invalid-feedback">Numele serviciului este obligatoriu.</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="categorie" class="form-label">Categorie</label>
                            <input type="text" class="form-control" id="categorie" name="categorie" placeholder="ex: Masaj, Fizioterapie">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="pretServiciu" class="form-label required">Preț (RON)</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="pretServiciu" name="pretServiciu" min="0" step="0.01" required>
                                <span class="input-group-text">RON</span>
                            </div>
                            <div class="invalid-feedback">Prețul este obligatoriu și trebuie să fie pozitiv.</div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="durataServiciu" class="form-label required">Durată (minute)</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="durataServiciu" name="durataServiciu" min="1" required>
                                <span class="input-group-text">min</span>
                            </div>
                            <div class="invalid-feedback">Durata este obligatorie și trebuie să fie de cel puțin 1 minut.</div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="contact" class="form-label required">Contact</label>
                            <input type="text" class="form-control" id="contact" name="contact" required>
                            <div class="invalid-feedback">Contactul este obligatoriu.</div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="descriereServiciu" class="form-label">Descriere</label>
                        <textarea class="form-control" id="descriereServiciu" name="descriereServiciu" rows="4" placeholder="Descrierea serviciului..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>Anulează
                </button>
                <button type="button" class="btn btn-primary" id="saveServiceBtn" onclick="saveService()">
                    <i class="fas fa-save me-1"></i>Salvează Serviciu
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-danger" id="deleteConfirmModalLabel">
                    <i class="fas fa-exclamation-triangle me-2"></i>Confirmă ștergerea
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Închide"></button>
            </div>
            <div class="modal-body">
                <p>Ești sigur că vrei să ștergi acest serviciu?</p>
                <p class="text-muted"><strong id="serviceToDeleteName"></strong></p>
                <p class="text-danger small">Această acțiune este ireversibilă și va șterge definitiv serviciul din sistem.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Anulează</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                    <i class="fas fa-trash me-1"></i>Șterge
                </button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Global variables
    let allServices = [];
    let currentServices = [];
    let editMode = false;
    let serviceToDeleteId = null;

    // DOM elements
    const serviceModal = new bootstrap.Modal(document.getElementById('serviceModal'));
    const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));

    // API call utility
    async function apiCall(url, method = 'GET', data = null) {
        const options = {
            method: method,
            headers: {
                'Content-Type': 'application/json',
            },
        };
        if (data) {
            options.body = JSON.stringify(data);
        }

        try {
            const response = await fetch(url, options);
            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`API Error ${response.status}: ${errorText || response.statusText}`);
            }
            if (response.status === 204) return null; // No content for delete
            return await response.json();
        } catch (error) {
            console.error(`Error in API call to ${url}:`, error);
            showAlert(`Eroare: ${error.message}`, 'danger');
            throw error;
        }
    }

    // Alert/Notification system
    function showAlert(message, type = 'info') {
        const alertHtml = `
            <div class="alert alert-${type} alert-dismissible fade show shadow-sm" role="alert">
                <div class="d-flex align-items-center">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'danger' ? 'fa-exclamation-triangle' : 'fa-info-circle'} me-2"></i>
                    <div>${message}</div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        `;
        const alertElement = document.createElement('div');
        alertElement.innerHTML = alertHtml;
        document.getElementById('alertContainer').prepend(alertElement.firstChild);

        // Auto-close after 5 seconds
        setTimeout(() => {
            const bsAlert = bootstrap.Alert.getOrCreateInstance(alertElement.firstChild);
            bsAlert.close();
        }, 5000);
    }

    // Load services when page loads
    document.addEventListener('DOMContentLoaded', function() {
        loadServices();
        setupEventListeners();
    });

    function setupEventListeners() {
        // Search on Enter key
      document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
    if (serviceToDeleteId) {
        deleteService(serviceToDeleteId); // <-- This calls the deletion API
    }
});

        // Confirm delete button
        document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
            if (serviceToDeleteId) {
                deleteService(serviceToDeleteId);
            }
        });
    }

    async function loadServices() {
        showLoadingState(true);
        try {
            const services = await apiCall('/api/admin/services');
            allServices = services || [];
            currentServices = [...allServices];

            renderServices();
            updateStats();
            populateCategoryFilter();

        } catch (error) {
            console.error('Error loading services:', error);
            showEmptyState('Eroare la încărcarea serviciilor. Vă rugăm să reîncărcați pagina.');
        } finally {
            showLoadingState(false);
        }
    }

    function renderServices() {
        const container = document.getElementById('servicesContainer');

        if (currentServices.length === 0) {
            showEmptyState('Nu există servicii care să corespundă criteriilor de căutare.');
            return;
        }

        container.innerHTML = currentServices.map(service => `
            <div class="col-lg-6 col-xl-4 mb-4">
                <div class="card service-card h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="card-title text-truncate me-2" title="${escapeHtml(service.numeServiciu)}">
                                ${escapeHtml(service.numeServiciu)}
                            </h5>
                            ${service.categorie ? `<span class="badge badge-category">${escapeHtml(service.categorie)}</span>` : ''}
                        </div>

                        <p class="card-text text-muted mb-3">
                            ${escapeHtml(service.descriereServiciu || 'Fără descriere disponibilă.')}
                        </p>

                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="badge badge-price">
                                <i class="fas fa-money-bill-wave me-1"></i>${service.pretServiciu} RON
                            </span>
                            <span class="badge badge-duration">
                                <i class="fas fa-clock me-1"></i>${service.durataServiciu} min
                            </span>
                        </div>

                        <p class="card-text mb-3">
                            <small class="text-muted">
                                <i class="fas fa-phone me-1"></i>${escapeHtml(service.contact)}
                            </small>
                        </p>
                    </div>
                    <div class="card-footer bg-transparent action-buttons">
                        <button class="btn btn-sm btn-outline-primary" onclick="editService(${service.id})" title="Modifică">
                            <i class="fas fa-edit me-1"></i>Modifică
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="confirmDelete(${service.id}, '${escapeHtml(service.numeServiciu)}')" title="Șterge">
                            <i class="fas fa-trash me-1"></i>Șterge
                        </button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function showEmptyState(message) {
        const container = document.getElementById('servicesContainer');
        container.innerHTML = `
            <div class="col-12">
                <div class="empty-state">
                    <i class="fas fa-spa"></i>
                    <h4 class="text-muted">${message}</h4>
                    <p class="mb-3">Adaugă un serviciu nou pentru a începe.</p>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#serviceModal" onclick="openAddModal()">
                        <i class="fas fa-plus me-1"></i>Adaugă primul serviciu
                    </button>
                </div>
            </div>
        `;
    }

    function showLoadingState(show) {
        const container = document.getElementById('servicesContainer');
        if (show) {
            container.innerHTML = `
                <div class="col-12">
                    <div class="loading-spinner">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Se încarcă...</span>
                        </div>
                        <span class="ms-2">Se încarcă serviciile...</span>
                    </div>
                </div>
            `;
        }
    }

    function updateStats() {
        document.getElementById('totalServices').textContent = allServices.length;
        document.getElementById('activeServices').textContent = allServices.length; // All services are considered active

        // Calculate unique categories
        const categories = [...new Set(allServices.map(s => s.categorie).filter(Boolean))];
        document.getElementById('totalCategories').textContent = categories.length;

        // Calculate average price
        const avgPrice = allServices.length > 0
            ? (allServices.reduce((sum, s) => sum + s.pretServiciu, 0) / allServices.length).toFixed(2)
            : 0;
        document.getElementById('averagePrice').textContent = avgPrice;
    }

    function populateCategoryFilter() {
        const categories = [...new Set(allServices.map(s => s.categorie).filter(Boolean))];
        const filter = document.getElementById('categoryFilter');

        // Keep the "All categories" option and add new ones
        filter.innerHTML = '<option value="">Toate categoriile</option>';
        categories.forEach(category => {
            const option = document.createElement('option');
            option.value = category;
            option.textContent = category;
            filter.appendChild(option);
        });
    }

    function searchServices() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();

        if (searchTerm === '') {
            currentServices = [...allServices];
        } else {
            currentServices = allServices.filter(service =>
                service.numeServiciu.toLowerCase().includes(searchTerm) ||
                (service.descriereServiciu && service.descriereServiciu.toLowerCase().includes(searchTerm)) ||
                (service.categorie && service.categorie.toLowerCase().includes(searchTerm))
            );
        }

        // Apply category filter if any
        filterServices();
    }

    function filterServices() {
        const category = document.getElementById('categoryFilter').value;

        if (category) {
            currentServices = currentServices.filter(service => service.categorie === category);
        }

        // Apply sorting
        sortServices();
    }

    function sortServices() {
        const sortBy = document.getElementById('sortBy').value;

        currentServices.sort((a, b) => {
            switch(sortBy) {
                case 'name':
                    return a.numeServiciu.localeCompare(b.numeServiciu);
                case 'price':
                    return a.pretServiciu - b.pretServiciu;
                case 'duration':
                    return a.durataServiciu - b.durataServiciu;
                case 'category':
                    return (a.categorie || '').localeCompare(b.categorie || '');
                default:
                    return 0;
            }
        });

        renderServices();
    }

    function openAddModal() {
        editMode = false;
        document.getElementById('serviceModalTitle').innerHTML = '<i class="fas fa-plus me-2"></i>Adaugă Serviciu Nou';
        document.getElementById('serviceForm').reset();
        document.getElementById('serviceId').value = '';

        // Remove validation classes
        const inputs = document.querySelectorAll('#serviceForm input, #serviceForm textarea');
        inputs.forEach(input => {
            input.classList.remove('is-invalid');
        });
    }

   function editService(serviceId) {
    console.log('Editing service ID:', serviceId); // Debug line

    const service = allServices.find(s => s.id === serviceId);
    if (!service) {
        showAlert('Serviciul nu a fost găsit!', 'danger');
        return;
    }

    // Debug: afișează datele serviciului
    console.log('Service data:', service);

    editMode = true;
    document.getElementById('serviceModalTitle').innerHTML = '<i class="fas fa-edit me-2"></i>Modifică Serviciu';

    // Fill form with service data
    document.getElementById('serviceId').value = service.id;
    document.getElementById('numeServiciu').value = service.numeServiciu || '';
    document.getElementById('descriereServiciu').value = service.descriereServiciu || '';
    document.getElementById('pretServiciu').value = service.pretServiciu || '';
    document.getElementById('durataServiciu').value = service.durataServiciu || '';
    document.getElementById('contact').value = service.contact || '';
    // Eliminați sau comentați linia cu categorie dacă nu există în backend
    // document.getElementById('categorie').value = service.categorie || '';

    serviceModal.show();
}

    function saveService() {
        const formData = {
            numeServiciu: document.getElementById('numeServiciu').value.trim(),
            descriereServiciu: document.getElementById('descriereServiciu').value.trim(),
            pretServiciu: parseFloat(document.getElementById('pretServiciu').value),
            durataServiciu: parseInt(document.getElementById('durataServiciu').value),
            contact: document.getElementById('contact').value.trim(),
            categorie: document.getElementById('categorie').value.trim()
        };

        const serviceId = document.getElementById('serviceId').value;

        // --- NEW VALIDATION AND GUARD BLOCK ---
        // 1. Standard Client-Side Validation (Required fields)
        if (!validateForm(formData)) {
            // The validateForm function will add 'is-invalid' classes
            return;
        }

        // 2. Edit Mode Guard (Ensures ID is present and valid for PUT request)
        if (editMode) {
            if (!serviceId || serviceId === "undefined" || isNaN(parseInt(serviceId))) {
                showAlert('Eroare: ID-ul serviciului lipsește pentru modificare.', 'danger');
                return; // STOP execution if ID is invalid during edit
            }
        }
        // --- END VALIDATION AND GUARD BLOCK ---

        // 3. Determine URL and Method (ONLY ONCE)
        const url = editMode ? `/api/admin/services/${serviceId}` : '/api/admin/services';
        const method = editMode ? 'PUT' : 'POST';

        // 4. Show loading state on button
        const saveBtn = document.getElementById('saveServiceBtn');
        const originalText = saveBtn.innerHTML;
        saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Se salvează...';
        saveBtn.disabled = true;

        // 5. API Call
        apiCall(url, method, formData)
            .then(() => {
                serviceModal.hide();
                document.getElementById('serviceForm').reset();
                loadServices(); // Reload services to get updated data
                showAlert(`Serviciu ${editMode ? 'modificat' : 'adăugat'} cu succes!`, 'success');
            })
            .catch(() => {
                // The apiCall utility already shows an alert on error,
                // but we need to restore the button state even on failure.
            })
            .finally(() => {
                // Restore button state
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
            });
    }

    function validateForm(formData) {
        let isValid = true;

        // Reset validation
        const inputs = document.querySelectorAll('#serviceForm input[required]');
        inputs.forEach(input => {
            input.classList.remove('is-invalid');
        });

        // Check required fields
        if (!formData.numeServiciu) {
            document.getElementById('numeServiciu').classList.add('is-invalid');
            isValid = false;
        }
        if (!formData.pretServiciu || formData.pretServiciu <= 0) {
            document.getElementById('pretServiciu').classList.add('is-invalid');
            isValid = false;
        }
        if (!formData.durataServiciu || formData.durataServiciu <= 0) {
            document.getElementById('durataServiciu').classList.add('is-invalid');
            isValid = false;
        }
        if (!formData.contact) {
            document.getElementById('contact').classList.add('is-invalid');
            isValid = false;
        }

        return isValid;
    }

    function confirmDelete(serviceId, serviceName) {
        serviceToDeleteId = serviceId;
        document.getElementById('serviceToDeleteName').textContent = serviceName;
        deleteModal.show();
    }

    function deleteService(serviceId) {
        apiCall(`/api/admin/services/${serviceId}`, 'DELETE')
            .then(() => {
                deleteModal.hide();
                loadServices();
                showAlert('Serviciu șters cu succes!', 'success');
            })
            .finally(() => {
                serviceToDeleteId = null;
            });
    }

    function escapeHtml(unsafe) {
        if (!unsafe) return '';
        return unsafe
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }
</script>
</body>
</html>
</html>